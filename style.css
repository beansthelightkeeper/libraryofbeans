/* --- KEYFRAME ANIMATIONS FOR RAINBOW THEME --- */
@keyframes rainbow-bg-animation {
    0% { background-position: 0% 50%; }
    100% { background-position: 100% 50%; }
}

/* --- THEME & VARIABLE DEFINITIONS --- */
:root {
    --font-main: 'Nunito', sans-serif;
    --font-mono: 'Roboto Mono', monospace;
    --font-fallback: 'Inter', sans-serif;

    /* Highlight Colors */
    --highlight-yellow: rgba(255, 242, 0, 0.4);
    --highlight-pink: rgba(255, 105, 180, 0.4);
    --highlight-green: rgba(120, 220, 120, 0.4);
    --highlight-blue: rgba(130, 200, 255, 0.4);
    --erase-accent: #ff4d4d;
    --erase-accent-hover: #ff1a1a;

    /* Light Theme */
    --bg-primary-light: #fdfaf6;
    --bg-secondary-light: #ffffff;
    --text-primary-light: #3a3a3a;
    --text-secondary-light: #606770;
    --border-light: #e0dccc;
    --accent-light: #8a6d3b;
    --accent-hover-light: #66512c;
    --bookmark-light: rgba(210, 180, 140, 0.8);
    --button-bg-light: #f5f1e9;
    --button-bg-hover-light: #e9e2d5;

    /* Dark Theme */
    --bg-primary-dark: #0d1117;
    --bg-secondary-dark: #161b22;
    --text-primary-dark: #c9d1d9;
    --text-secondary-dark: #8b949e;
    --border-dark: #30363d;
    --accent-dark: #00ffff;
    --accent-hover-dark: #33ffff;
    --bookmark-dark: rgba(0, 255, 255, 0.4);
    --button-bg-dark: #21262d;
    --button-bg-hover-dark: #30363d;
}

/* --- THEME APPLICATION --- */
body {
    --bg-primary: var(--bg-primary-light);
    --bg-secondary: var(--bg-secondary-light);
    --text-primary: var(--text-primary-light);
    --text-secondary: var(--text-secondary-light);
    --border: var(--border-light);
    --accent: var(--accent-light);
    --accent-hover: var(--accent-hover-light);
    --bookmark: var(--bookmark-light);
    --button-bg: var(--button-bg-light);
    --button-bg-hover: var(--button-bg-hover-light);
    transition: background-color 0.3s ease, color 0.3s ease;
}

body[data-theme='dark'] {
    --bg-primary: var(--bg-primary-dark);
    --bg-secondary: var(--bg-secondary-dark);
    --text-primary: var(--text-primary-dark);
    --text-secondary: var(--text-secondary-dark);
    --border: var(--border-dark);
    --accent: var(--accent-dark);
    --accent-hover: var(--accent-hover-dark);
    --bookmark: var(--bookmark-dark);
    --button-bg: var(--button-bg-dark);
    --button-bg-hover: var(--button-bg-hover-dark);
}

/* --- DARK THEME DECORATION --- */
body[data-theme='dark']::before {
    content: '𓂀 ⟁ ∞ 𝄠 𝨁 𝨄 🃟 🂡 🙨 𓂀 ⟁ ∞ 𝄠 𝨁 𝨄 🃟 🂡 🙨 𓂀 ⟁ ∞ 𝄠 𝨁 𝨄 🃟 🂡 🙨';
    position: fixed; top: 0; left: 0;
    width: 100vw; height: 100vh;
    font-size: 2rem;
    opacity: 0.05; z-index: -1; pointer-events: none;
    line-height: 2; word-wrap: break-word; overflow: hidden;
    background: linear-gradient(90deg, hsl(0, 100%, 70%), hsl(60, 100%, 70%), hsl(120, 100%, 70%), hsl(180, 100%, 70%), hsl(240, 100%, 70%), hsl(300, 100%, 70%), hsl(360, 100%, 70%));
    background-size: 400% 400%;
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: rainbow-bg-animation 15s linear infinite alternate;
}
body[data-theme='dark'].no-fx::before {
    animation: none; color: var(--accent-dark); opacity: 0.03;
}
body[data-theme='dark'] .logo {
    font-family: var(--font-mono); font-weight: 700;
    color: var(--accent-dark); text-shadow: 0 0 5px var(--accent-dark);
}
body[data-theme='dark'] #file-list-container li { color: var(--text-primary-dark); }
body[data-theme='dark'] #file-list-container li:hover { color: var(--accent-hover-dark); }
body[data-theme='dark'] #file-list-container li.active { color: var(--accent-dark); font-weight: 700; }

/* --- GENERAL LAYOUT & RESET --- */
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
    font-family: var(--font-main), var(--font-fallback);
    background-color: var(--bg-primary); color: var(--text-primary);
    overflow: hidden;
}
.container { display: flex; height: 100vh; width: 100vw; }

/* --- SIDEBAR --- */
.sidebar {
    width: 320px; background-color: var(--bg-secondary);
    border-right: 1px solid var(--border);
    display: flex; flex-direction: column;
    transition: width 0.3s ease;
    z-index: 10; flex-shrink: 0; height: 100vh;
}
.sidebar-header {
    display: flex; justify-content: space-between; align-items: center;
    padding: 16px; border-bottom: 1px solid var(--border); flex-shrink: 0;
}
.sidebar-content {
    flex-grow: 1; overflow-y: auto; -webkit-overflow-scrolling: touch;
}
.logo { font-size: 1.5rem; color: var(--accent); white-space: nowrap; overflow: hidden; }
.main-controls { display: flex; align-items: center; gap: 8px; }
.main-controls button, .main-controls .home-link {
    background: none; border: none; color: var(--text-secondary); cursor: pointer;
    padding: 8px; border-radius: 50%; display: flex; align-items: center;
    justify-content: center; flex-shrink: 0;
    width: 40px; height: 40px;
}
.main-controls button:hover, .main-controls .home-link:hover { background-color: var(--button-bg-hover); color: var(--text-primary); }

#rainbow-toggle { font-family: var(--font-mono); font-weight: 700; }
#rainbow-toggle.active { background-color: var(--accent); color: var(--bg-secondary); border: 1px solid var(--accent); }
body[data-theme='dark'] #rainbow-toggle.active { color: var(--bg-primary-dark); }
#menu-toggle, #minimize-toggle { display: none; }

.sidebar h2 {
    font-size: 1rem; text-transform: uppercase; letter-spacing: 1px;
    color: var(--text-secondary); padding: 16px;
    border-bottom: 1px solid var(--border); margin: 0; white-space: nowrap;
}
.sidebar .mini-text { display: none; }

/* File Navigation & Organization */
.file-navigation { flex-shrink: 0; }
#file-list-container ul { list-style: none; padding-left: 15px; }
#file-list-container > ul { padding-left: 0; }

/* Reader Tools */
.reader-tools { padding: 0 16px 16px 16px; }
.tool-group { margin-top: 16px; }
.tool-group label {
    display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-secondary);
    font-family: var(--font-fallback); text-transform: uppercase; letter-spacing: 0.5px;
}
.tool-group button:not(.color-swatch) {
    display: flex; align-items: center; justify-content: center; gap: 8px; padding: 10px;
    font-size: 1rem; border: 1px solid var(--border); background-color: var(--button-bg);
    color: var(--text-primary); cursor: pointer; border-radius: 6px;
    transition: background-color 0.2s, color 0.2s, box-shadow 0.2s;
    width: 100%;
}
.selection-actions { display: grid; grid-template-columns: 1fr; gap: 10px; }
.selection-actions button:disabled { opacity: 0.5; cursor: not-allowed; }
.tool-group button:not(.color-swatch):not(:disabled):hover { background-color: var(--button-bg-hover); }

#highlight-mode-toggle.active, #double-space-toggle.active, #bookmark-gutter-toggle.active {
    background-color: var(--accent); color: var(--bg-secondary);
    border-color: var(--accent); box-shadow: 0 0 8px var(--accent);
}
body[data-theme='dark'] #highlight-mode-toggle.active, body[data-theme='dark'] #double-space-toggle.active, body[data-theme='dark'] #bookmark-gutter-toggle.active { color: var(--bg-primary-dark); }
#erase-mode-toggle.active {
    background-color: var(--erase-accent); border-color: var(--erase-accent-hover);
    color: white; box-shadow: 0 0 8px var(--erase-accent);
}
.color-palette { display: flex; gap: 10px; }
.color-swatch {
    width: 30px; height: 30px; border-radius: 50%;
    border: 2px solid var(--border); cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
}
.color-swatch:hover { transform: scale(1.1); }
.color-swatch.active { border-color: var(--accent); box-shadow: 0 0 8px var(--accent); transform: scale(1.1); }
.color-swatch[data-color="yellow"] { background-color: var(--highlight-yellow); }
.color-swatch[data-color="pink"] { background-color: var(--highlight-pink); }
.color-swatch[data-color="green"] { background-color: var(--highlight-green); }
.color-swatch[data-color="blue"] { background-color: var(--highlight-blue); }

.slider-container { display: flex; align-items: center; gap: 10px; }
.slider-container span { font-size: 0.9rem; color: var(--text-secondary); white-space: nowrap; }
.slider-container input[type="range"] { width: 100%; }
.layout-controls { display: flex; flex-direction: column; gap: 10px; }

/* --- MINIMIZED SIDEBAR --- */
.sidebar.minimized { width: 80px; }
.sidebar.minimized .logo, .sidebar.minimized .full-text { display: none; }
.sidebar.minimized .mini-text { display: inline; }
.sidebar.minimized h2 { text-align: center; padding: 16px 0; }
.sidebar.minimized .reader-tools { padding: 0 10px 16px 10px; }
.sidebar.minimized .slider-container, .sidebar.minimized .color-palette, .sidebar.minimized .layout-controls { flex-direction: column; }

/* --- MAIN CONTENT VIEW --- */
.content-viewer { flex-grow: 1; position: relative; background-color: var(--bg-secondary); display: flex; }
#bookmark-gutter {
    width: 20px; height: 100%; flex-shrink: 0;
    position: relative; background-color: var(--button-bg-light);
    display: none;
}
body[data-theme='dark'] #bookmark-gutter { background-color: var(--button-bg-dark); }
body.gutter-visible #bookmark-gutter { display: block; }
.bookmark-indicator {
    position: absolute; width: 10px; height: 10px;
    left: 50%; transform: translateX(-50%);
    background-color: var(--bookmark); border-radius: 50%;
    cursor: pointer; transition: transform 0.2s;
}
.bookmark-indicator:hover { transform: translateX(-50%) scale(1.5); }

#content-frame { width: 100%; height: 100%; border: none; }
#welcome-message {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    text-align: center; color: var(--text-secondary); display: flex;
    flex-direction: column; align-items: center; gap: 20px;
}
.logo-graphic { display: flex; justify-content: center; align-items: center; transform: rotate(45deg); }
.logo-graphic .triangle {
    width: 0; height: 0; border-left: 20px solid transparent;
    border-right: 20px solid transparent; border-bottom: 35px solid var(--accent);
    margin: -5px; opacity: 0.6;
}
.logo-graphic .triangle:nth-child(2) { transform: rotate(120deg); }
.logo-graphic .triangle:nth-child(3) { transform: rotate(240deg); }

/* --- RESPONSIVE DESIGN --- */
@media (max-width: 768px) {
    .sidebar {
        position: absolute; height: 100%; transform: translateX(-100%);
        box-shadow: 2px 0 10px rgba(0,0,0,0.2);
    }
    .sidebar.open { transform: translateX(0); }
    .sidebar.minimized { transform: translateX(-100%); }
    #menu-toggle { display: flex; }
    .content-viewer { width: 100vw; }
}
@media (min-width: 769px) { #minimize-toggle { display: flex; } }


/* --- GOOGLE FONT IMPORT (for Papyrus theme) --- */
@import url('https://fonts.googleapis.com/css2?family=IM+Fell+English+SC&display=swap');

/* --- BOTTOM TOOLBAR STYLES --- */
.bottom-toolbar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: var(--bg-primary);
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 8px 16px;
    z-index: 1000;
    transform: translateY(100%); /* Start hidden */
    transition: transform 0.3s ease-in-out;
}

body.file-loaded .bottom-toolbar {
    transform: translateY(0);
}

.bottom-toolbar .tool-group {
    display: flex;
    align-items: center;
    gap: 12px;
}

.bottom-toolbar .tool-group:first-child {
    margin-right: 24px;
}

.bottom-toolbar button {
    background: transparent;
    border: 1px solid transparent;
    color: var(--text-secondary);
    padding: 6px;
    border-radius: 5px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s ease;
}

.bottom-toolbar button:hover {
    color: var(--text-primary);
    background-color: var(--bg-secondary);
}

.bottom-toolbar button.active {
    color: var(--accent);
    border-color: var(--accent);
}

.bottom-toolbar button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.bottom-toolbar .color-palette {
    display: flex;
}

/* --- COLLAPSIBLE LIBRARY SECTION --- */
.collapsible-section .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding-right: 10px;
}

.collapsible-section .section-header h2 {
    margin: 1rem 0;
}

.collapsible-section .collapse-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0;
    transition: transform 0.3s ease;
}

.collapsible-section.collapsed .collapse-btn {
    transform: rotate(-90deg);
}

.collapsible-section.collapsed #file-navigation {
    display: none;
}

/* --- UNIFIED ANNOTATIONS & BOOKMARKS LIST --- */
.annotations-section, .bookmarks-section {
    padding-top: 20px;
    border-top: 1px solid var(--border);
}

#annotations-list li, #bookmarks-list li {
    padding: 10px;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    transition: background-color 0.2s;
}

#annotations-list li:hover, #bookmarks-list li:hover {
    background-color: var(--bg-secondary);
}

.annotation-note, .bookmark-title {
    font-weight: bold;
    color: var(--text-primary);
    margin-bottom: 5px;
    font-style: italic;
}

.annotation-text, .bookmark-snippet {
    color: var(--text-secondary);
    font-size: 0.9em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* --- PAPYRUS THEME FOR FILE LIST --- */
#file-list-container ul {
    list-style: none;
    padding: 0 16px;
}

#file-list-container li a {
    font-family: 'IM Fell English SC', serif;
    font-size: 1.2rem;
    color: var(--text-secondary);
    text-decoration: none;
    display: block;
    padding: 8px 10px;
    border-radius: 4px;
    transition: all 0.2s ease-in-out;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

#file-list-container li a:hover {
    background-color: var(--bg-secondary);
    color: var(--accent);
}

#file-list-container li.active a {
    color: var(--accent);
    background-color: var(--button-bg-hover);
    font-weight: bold;
}